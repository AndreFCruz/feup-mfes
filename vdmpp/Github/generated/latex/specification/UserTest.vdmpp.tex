\begin{vdmpp}[breaklines=true]
class UserTest

 instance variables
  private users : seq of User := [new User("n") | dummy in set {1, ..., 5}];
  private user : User := new User("username");
 
 operations
(*@
\label{testFollowUnfollow:8}
@*)
  private testFollowUnfollow: () ==> ()
  testFollowUnfollow() == (
   let u = TestUtils`randomUser(users) in (
    user.follow(u);
    TestUtils`assertTrue(u in set user.getFollowing() and user in set u.getFollowers());
    user.clearFollowing();
    TestUtils`assertFalse(u in set user.getFollowing() or user in set u.getFollowers());
   )
  );
  
(*@
\label{testNewRepo:18}
@*)
  private testNewRepo: () ==> ()
  testNewRepo() == (
   let r = user.newRepository("FEUP-MFES", true) in (
    TestUtils`assertTrue(user.repositories(r.name) = r)
   );
  );
  
(*@
\label{testStarUnstar:25}
@*)
  private testStarUnstar: () ==> ()
  testStarUnstar() == (
   let r = (TestUtils`randomUser(users)).newRepository("FEUP-MFES", true) in (
    TestUtils`assertTrue(user.getStars() = {});
    user.star(r);
    TestUtils`assertTrue(user.getStars() = {r});
    user.unstar(r);
    TestUtils`assertTrue(user.getStars() = {});
   );
  );
 
(*@
\label{main:36}
@*)
  public static main: () ==> ()
  main() == (
   let ut = new UserTest() in (
    ut.testFollowUnfollow();
    ut.testNewRepo();
    ut.testStarUnstar();
   );
  );

 traces
  FollowUnfollow :
   (*@\vdmnotcovered{user}@*).clearFollowing();
   (let u = TestUtils`randomUser(users) in (*@\vdmnotcovered{user}@*).follow((*@\vdmnotcovered{u}@*))){1, 5};
   (let u = (*@\vdmnotcovered{TestUtils`randomUser}@*)((*@\vdmnotcovered{users}@*)) in (*@\vdmnotcovered{user}@*).unfollow((*@\vdmnotcovered{u}@*))){1, 5};

end UserTest
\end{vdmpp}
\bigskip
\begin{longtable}{|l|r|r|r|}
\hline
Function or operation & Line & Coverage & Calls \\
\hline
\hline
\hyperref[main:36]{main} & 36&100.0\% & 1 \\
\hline
\hyperref[testFollowUnfollow:8]{testFollowUnfollow} & 8&100.0\% & 1 \\
\hline
\hyperref[testNewRepo:18]{testNewRepo} & 18&100.0\% & 1 \\
\hline
\hyperref[testStarUnstar:25]{testStarUnstar} & 25&100.0\% & 1 \\
\hline
\hline
UserTest.vdmpp & & 90.7\% & 4 \\
\hline
\end{longtable}

